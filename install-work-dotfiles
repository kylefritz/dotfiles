#!/usr/bin/env bash

# Install work dotfiles configuration
# This script sets up starship prompt with work-specific modules

set -e

# Determine starship config directory
STARSHIP_CONFIG_DIR="${XDG_CONFIG_HOME:-$HOME/.config}"

echo "Installing work dotfiles..."

# Create starship config directory if it doesn't exist
mkdir -p "$STARSHIP_CONFIG_DIR"

# Link starship configuration
if [[ -h "$STARSHIP_CONFIG_DIR/starship.toml" ]]; then
  echo "Relinking $STARSHIP_CONFIG_DIR/starship.toml"
  rm "$STARSHIP_CONFIG_DIR/starship.toml"
  ln -s "$HOME/.dotfiles/starship.work.toml" "$STARSHIP_CONFIG_DIR/starship.toml"
elif [[ -f "$STARSHIP_CONFIG_DIR/starship.toml" ]]; then
  echo "Backing up existing starship.toml"
  mv "$STARSHIP_CONFIG_DIR/starship.toml" "$STARSHIP_CONFIG_DIR/starship.toml.backup"
  ln -s "$HOME/.dotfiles/starship.work.toml" "$STARSHIP_CONFIG_DIR/starship.toml"
else
  echo "Linking $STARSHIP_CONFIG_DIR/starship.toml"
  ln -s "$HOME/.dotfiles/starship.work.toml" "$STARSHIP_CONFIG_DIR/starship.toml"
fi

echo "âœ“ Work dotfiles installed successfully"
echo ""
echo "Next steps:"
echo "  - Restart your shell or run: source ~/.config/fish/config.fish"
echo "  - Ensure ~/.local/bin/check-auth-expiry.sh exists"
echo "  - Ensure ~/.local/bin/jj-init-worktree.sh exists"
